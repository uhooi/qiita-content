---
title: Publishã§è¨˜äº‹ã«ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•(Swift)
tags:
  - Twitter
  - static_site_generator
  - Swift
  - publish
private: false
updated_at: '2022-04-06T22:20:46+09:00'
id: 9aa046f0a42e5afbd7c3
organization_url_name: null
---
ã€ŒPublishã§Webã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹ã€ã¯6éƒ¨æ§‹æˆã§ã™ã€‚
è¨˜äº‹ã‚’é †ç•ªã«èª­ã¿é€²ã‚ã‚‹ã¨ã€Publishã§Webã‚µã‚¤ãƒˆãŒæ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ç¬¬1éƒ¨: [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—&ä½¿ã„æ–¹](https://qiita.com/uhooi/items/57e040df2f4aa7f62d89)
ç¬¬2éƒ¨: [ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã®ä½œæˆ](https://qiita.com/uhooi/items/111d4439273775586149)
ç¬¬3éƒ¨: [ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](https://qiita.com/uhooi/items/bf0ff67d687b53a11c5b)
ç¬¬4éƒ¨: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œæˆï¼ˆæœªæŠ•ç¨¿ï¼‰
ç¬¬5éƒ¨: ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã€€__â†ã‚¤ãƒã‚³ã‚³__
ç¬¬6éƒ¨: [ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒœã‚¿ãƒ³ã®è¡¨ç¤º](https://qiita.com/uhooi/items/40cb71ac3aca57853544)

## ã¯ã˜ã‚ã«

Publishã§è¨˜äº‹ã«ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ç’°å¢ƒ

- OSï¼šmacOS Monterey 12.2.1
- Xcodeï¼š13.3 (13E113)
- Swiftï¼š5.6
- Publishï¼š0.8.0

## ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®HTMLã®æŠŠæ¡

ã¾ãšãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®HTMLã‚’æŠŠæ¡ã—ã€ç”Ÿæˆå¾Œã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ´ã¿ã¾ã™ã€‚
è©³ç´°ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

https://qiita.com/uhooi/items/9053b5c9b975d0591a61

## å®Ÿè£…

### URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å‡¦ç†ã®å®Ÿè£…

`String` å‹ã‚’URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ç§ã¯ä»¥ä¸‹ã®è¨˜äº‹ã®å†…å®¹ã‚’ã»ã¼ãã®ã¾ã¾ä½¿ã‚ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

https://dev.classmethod.jp/articles/urlencode-spec-and-implementation-for-swift/

```swift:String+URL.swift
import Foundation

extension String {
    func urlEncoded() -> String {
        let allowedChars = CharacterSet.alphanumerics.union(.init(charactersIn: "/?-._~"))
        let decoded = removingPercentEncoding ?? self
        return decoded.addingPercentEncoding(withAllowedCharacters: allowedChars) ?? decoded
    }
}
```

`"{æ–‡å­—åˆ—}".urlEncoded()` ã§æ–‡å­—åˆ—ã‚’URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```swift
"iOS OsushiğŸ£".urlEncoded() // "iOS%20Osushi%F0%9F%8D%A3"
```

ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã«æ¸¡ã™æ–‡å­—åˆ—ã¯ã™ã¹ã¦URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã¹ãã§ã™ã€‚

### HTMLæ§‹ç¯‰å‡¦ç†ã®æ›´æ–°

ãƒ†ãƒ¼ãƒã®HTMLæ§‹ç¯‰å‡¦ç†ã‚’æ›´æ–°ã—ã€ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’é…ç½®ã—ã¾ã™ã€‚

```diff_swift:Theme+IosOsushi.swift
private struct IosOsushiHTMLFactory<Site: Website>: HTMLFactory {
    func makeItemHTML(for item: Item<Site>, context: PublishingContext<Site>) throws -> HTML {
        HTML(
            .lang(context.site.language),
            .head(for: item, on: context.site),
            .body(
+               .script(.async(), .src("https://platform.twitter.com/widgets.js")),
                .class("item-page"),
                .components {
                    SiteHeader(context: context, selectedSelectionID: item.sectionID)
                    Wrapper {
                        Article {
+                           Div {
+                               TweetButton(item: item, site: context.site)
+                           }
+                           .class("share-buttons")
                            Div(item.content.body).class("content")
                            Span("Tagged with: ")
                            ItemTagList(item: item, site: context.site)
                        }
                    }
                    SiteFooter()
                }
            )
        )
    }

+   private struct TweetButton<Site: Website>: Component {
+       private var tweetText: String { "\(item.title) | \(site.name)" }
+       private var urlString: String { site.url.absoluteString + item.path.absoluteString }
+       private let hashtag = "ios_osushi"
+       private let username = "ios_osushi"
+
+       var item: Item<Site>
+       var site: Site
+       var body: Component {
+           Link("ãƒ„ã‚¤ãƒ¼ãƒˆ", url: "https://twitter.com/intent/tweet?text=\(tweetText.urlEncoded())&url=\(urlString.urlEncoded())&hashtags=\(hashtag.urlEncoded())&via=\(username.urlEncoded())")
+               .class("twitter-share-button")
+       }
+   }
}
```

ãƒœã‚¿ãƒ³ã®ä¸‹ã«ãƒãƒ¼ã‚¸ãƒ³ã‚’ä»˜ã‘ã¾ã™ã€‚
CSSã«è©³ã—ããªã„ã®ã§ã€ `class` ã®å‘½åã‚„ã€ãã‚‚ãã‚‚ `class` ã«ãƒãƒ¼ã‚¸ãƒ³ã‚’ä»˜ã‘ã‚‹ã®ãŒã„ã„ã®ã‹ãªã©ãŒã‚ã‹ã‚Šã¾ã›ã‚“ã€‚
ä»–ã«ã„ã„æ–¹æ³•ãŒã‚ã‚Œã°æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚

```diff_css:styles.css
+ .share-buttons {
+     margin-bottom: 10px;
+ }
```

JSã®èª­ã¿è¾¼ã¿ã¯ `.body()` ä»¥å¤–ã®ç®‡æ‰€ã«ä»•è¾¼ã‚€æ–¹æ³•ãŒã‚ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ã€ `<body>...</body>` ã§è¡Œã£ã¦ã„ã¾ã™ã€‚

ä»Šå›ã® `TweetButton` ã®ã‚ˆã†ã«ã€è¦ç´ ã®ã¾ã¨ã¾ã‚Šã¯ `Component` ã‚’ç¶™æ‰¿ã—ãŸæ§‹é€ ä½“ã§è¡¨ç¾ã™ã‚‹ã¨å¯èª­æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚
`body` ã«è¦ç´ ã®ã¾ã¨ã¾ã‚Šã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ãƒ„ã‚¤ãƒ¼ãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆã‚„URLã€ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯ã€å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

`publish-cli run` ã‚’å®Ÿè¡Œã—ã€è¨˜äº‹ã®ä¸Šéƒ¨ã«ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰OKã§ã™ã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-04-06 11.13.30.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/138245/b4143d27-a4ba-0934-dec6-cf48bc4875d8.png)

## ãŠã‚ã‚Šã«

ã“ã‚Œã§è¨˜äº‹ã«ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã§ãã¾ã—ãŸï¼

## å‚è€ƒãƒªãƒ³ã‚¯

- [ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã™ã‚‹ by uhooi Â· Pull Request #24 Â· ios-osushi/website](https://github.com/ios-osushi/website/pull/24)
